<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Image Generator</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        box-sizing: border-box; /* Better for Bootstrap stability */
      }
      body {
        background-color: #f8f9fa;
        /* background-color: #1f1f1f; */
      }
      .header-section {
        padding: 40px 10px;
      }
      .contain {
        width: 100%;
        margin: 30px auto 0;
        display: flex;
        justify-content: center;

        padding: 0 12px;
      }

      .contain img {
        max-width: 100%;
        height: auto;

        object-fit: contain;
        object-position: center;

        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        background-color: white;
      }

      #loader {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: -1;
        text-align: center;
      }
      .loader {
        width: 48px;
        height: 48px;
        border: 3px solid #fff;
        border-radius: 50%;
        display: inline-block;
        position: relative;
        box-sizing: border-box;
        animation: rotation 1s linear infinite;
      }
      .loader::after {
        content: "";
        box-sizing: border-box;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 3px solid;
        border-color: #ff3d00 transparent;
      }

      @keyframes rotation {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="header-section text-center">
      <h1 class="display-5 fw-bold mb-3">Text-To-Image Generator</h1>
    </div>

    <div style="max-width: 800px; margin: auto" class="px-3">
      <div class="input-group mb-3 shadow-sm">
        <input
          type="text"
          id="userPrompt"
          class="form-control"
          placeholder="Describe the image you want to see..."
          aria-label="Enter Your Prompt"
          name="prompt"
        />
        <button id="btn" class="btn btn-primary px-4" type="button">
          Generate
        </button>
      </div>
    </div>
    <div id="loader"><span class="loader"></span></div>

    <div id="imageContainer" class="contain">
      <img
        id="actualImg"
        src="../static/openimg.png"
        height="400px"
        width="400px"
        alt="Preview"
      />
    </div>

    <script>
      const btn = document.getElementById("btn"); //button element
      const inputField = document.getElementById("userPrompt"); //input field
      const container = document.getElementById("imageContainer"); //image container

      // Event listener for button click
      btn.addEventListener("click", (e) => {
        container.style.display = "none"; 
        e.preventDefault();
        const promptValue = inputField.value;
        // Validate input
        if (!promptValue) {
          alert("Please enter a prompt first!");
          return;
        }

        // Show a loading state
        btn.innerText = "Generating...";
        btn.disabled = true;

        // Send POST request to the server
        fetch("/generate-images", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ prompt: promptValue }), 
        })
        // Handle the response
          .then((response) => {
            if (!response.ok) throw new Error("Network response was not ok");
            return response.json();
          })
          // Process the data
          .then((data) => {
          if(data.error){
                alert("Your prompt may contain text that is not allowed by our safety system. Please give another prompt" );
                return;
            }
           else{
            console.log("Success:", data); // Log the response data
            const images = data.img; // Get the image URL from the response
            document.getElementById("actualImg").src = images; // Set the image source
            container.style.display = "flex";
           }
             
          })
          // Handle errors
          .catch((error) => {
            console.error("Error:", error);
            alert("Failed to generate image");
          })
          // Reset button state
          .finally(() => {
            btn.innerText = "Generate";
            btn.disabled = false;
          });
      });
    </script>
  </body>
</html>
